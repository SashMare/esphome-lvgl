lvgl:
  style_definitions:
    - id: roboto15_cyrillic_style
      text_font: roboto15_font

  top_layer:
    widgets:
      - label:
          text: "-° / -°"
          id: temperatures
          styles: roboto15_cyrillic_style
          align: LV_ALIGN_TOP_LEFT
          x: 8
          y: 4
          text_color: 0xFFFFFF
      - label:
          text: "--:--"
          id: display_time
          styles: roboto15_cyrillic_style
          align: LV_ALIGN_TOP_MID
          x: 0
          y: 4
          text_align: LV_TEXT_ALIGN_CENTER
          text_color: 0xFFFFFF
          
  pages:
    - id: main_page
      layout:
        type: flex
        flex_flow: LV_FLEX_FLOW_COLUMN_WRAP
      width: lv_pct(100)
      bg_color: black
      bg_opa: LV_OPA_COVER
      pad_top: 30
      pad_bottom: 5
      pad_left: 5
      pad_right: 5

      widgets:
        # ==================== PYLONTECH BATTERY SECTION ====================
        - arc:
            id: battery_arc
            align: LV_ALIGN_TOP_MID
            width: 200
            height: 200
            rotation: 135
            min_value: 0
            max_value: 100
            value: !lambda 'return (int16_t) round(id(battery_soc).state);'
            bg_color: 0x222222
            bg_opa: LV_OPA_COVER
            line_width: 35
            line_color: 0x444444
            indicator:
              arc_color: 0x00FF00

        - label:
            id: battery_soc_label
            align: LV_ALIGN_TOP_MID
            y: -50
            text_font: montserrat_48
            text_color: 0xFFFFFF
            text: !lambda |-
              char buf[10];
              snprintf(buf, sizeof(buf), "%.1f%%", id(battery_soc).state);
              return buf;
              
        - label:
            id: battery_voltage_label
            align: LV_ALIGN_TOP_MID
            y: 110
            text_font: roboto15_cyrillic
            text_color: 0xFFFFFF
            text: !lambda |-
              char buf[20];
              snprintf(buf, sizeof(buf), "Напруга: %.2f В", id(battery_voltage));
              return buf;

        - label:
            id: battery_current_label
            align: LV_ALIGN_TOP_MID
            y: 140
            text_font: roboto15_cyrillic
            text_color: 0xFFFFFF
            text: !lambda |-
              char buf[20];
              snprintf(buf, sizeof(buf), "Струм: %.2f А", id(battery_current));
              return buf;

        - label:
            id: battery_temp_label
            align: LV_ALIGN_TOP_MID
            y: 170
            text_font: roboto15_cyrillic
            text_color: 0xFFFFFF
            text: !lambda |-
              char buf[20];
              snprintf(buf, sizeof(buf), "Темп: %.1f °C", id(battery_temp));
              return buf;

        - label:
            id: battery_status_label
            align: LV_ALIGN_TOP_MID
            y: 200
            text_font: roboto15_cyrillic
            text_color: !lambda 'return id(battery_soc).state > 0 ? lv_color_hex(0x00FF00) : lv_color_hex(0xFF0000);'
            text: !lambda 'return id(battery_status).state.c_str();'

        - button:
            height: $button_height_single
            width: $button_width
            checkable: false
            styles: control
            widgets:
              - label:
                  text_font: $icon_font
                  align: LV_ALIGN_TOP_LEFT
                  text: $battery
              - label:
                  align: LV_ALIGN_BOTTOM_LEFT
                  text: "Оновити батарею"
                  text_font: roboto15_cyrillic
            on_click:
              - component.update: my_pylontech

      # ==================== ТАБЛИЦЯ БАТАРЕЙ СТИЛЬ VICTRON ====================
      - obj:
          id: battery_table_container
          align: LV_ALIGN_BOTTOM_MID
          y: -10
          width: 300
          height: 280
          bg_color: 0x111111        # темний фон
          bg_opa: LV_OPA_COVER
          border_width: 2
          border_color: 0x003366    # Victron синій
          radius: 15
          pad_all: 0
          layout:
            type: grid
            grid_columns: [20, 30, 50, 20, 30, 30, 120]
            grid_rows: [35, 35, 35, 35, 35, 35]  # додаткові рядки для батарей
          widgets:

      # ================= HEADER =================
            - obj:
                grid_cell_row_pos: 0
                grid_cell_column_pos: 0
                grid_cell_column_span: 7
                height: 35
                bg_color: 0x003366   # синій фон заголовка
                widgets:
                  - label:
                      text_font: roboto12_cyrillic
                      text_color: 0xFFFFFF
                      text_align: LV_TEXT_ALIGN_CENTER
                      text: "Battery Table"
      
            # ================= COLUMNS =================
            - label:
                grid_cell_row_pos: 1
                grid_cell_column_pos: 0
                text_font: roboto12_cyrillic
                text_color: 0xE0E0E0
                text_align: LV_TEXT_ALIGN_CENTER
                text: "#"
            - label:
                grid_cell_row_pos: 1
                grid_cell_column_pos: 1
                text_font: roboto12_cyrillic
                text_color: 0xE0E0E0
                text_align: LV_TEXT_ALIGN_CENTER
                text: "SOC"
            - label:
                grid_cell_row_pos: 1
                grid_cell_column_pos: 2
                text_font: roboto12_cyrillic
                text_color: 0xE0E0E0
                text_align: LV_TEXT_ALIGN_CENTER
                text: "State"
            - label:
                grid_cell_row_pos: 1
                grid_cell_column_pos: 3
                text_font: roboto12_cyrillic
                text_color: 0xE0E0E0
                text_align: LV_TEXT_ALIGN_CENTER
                text: "V"
            - label:
                grid_cell_row_pos: 1
                grid_cell_column_pos: 4
                text_font: roboto12_cyrillic
                text_color: 0xE0E0E0
                text_align: LV_TEXT_ALIGN_CENTER
                text: "A"
            - label:
                grid_cell_row_pos: 1
                grid_cell_column_pos: 5
                text_font: roboto12_cyrillic
                text_color: 0xE0E0E0
                text_align: LV_TEXT_ALIGN_CENTER
                text: "Cycles"
            - label:
                grid_cell_row_pos: 1
                grid_cell_column_pos: 6
                text_font: roboto12_cyrillic
                text_color: 0xE0E0E0
                text_align: LV_TEXT_ALIGN_CENTER
                text: "Temp"
      
            # ================= BATTERY ROWS =================
            # Приклад для однієї батареї, можна копіювати на інші
            - obj:
                grid_cell_row_pos: 2
                grid_cell_column_pos: 0
                grid_cell_column_span: 7
                height: 35
                bg_color: 0x111111   # темний
                widgets:
                  - label:
                      grid_cell_column_pos: 0
                      text_font: roboto12_cyrillic
                      text_color: 0xFFFFFF
                      text_align: LV_TEXT_ALIGN_CENTER
                      text: "1"
                  - label:
                      grid_cell_column_pos: 1
                      text_font: roboto12_cyrillic
                      text_color: 0x00FF00   # SOC зелений
                      text_align: LV_TEXT_ALIGN_CENTER
                      text: !lambda |-
                        char buf[10];
                        snprintf(buf, sizeof(buf), "%.0f%%", id(battery_soc).state);
                        return buf;
                  - label:
                      grid_cell_column_pos: 2
                      text_font: roboto12_cyrillic
                      text_color: 0xFFFFFF
                      text_align: LV_TEXT_ALIGN_CENTER
                      text: !lambda 'return id(battery_status)->state.c_str();'
                  - label:
                      grid_cell_column_pos: 3
                      text_font: roboto12_cyrillic
                      text_color: 0xFFFFFF
                      text_align: LV_TEXT_ALIGN_CENTER
                      text: !lambda |-
                        char buf[10];
                        snprintf(buf, sizeof(buf), "%.2f", id(battery_voltage).state);
                        return buf;
                  - label:
                      grid_cell_column_pos: 4
                      text_font: roboto12_cyrillic
                      text_color: 0xFFFFFF
                      text_align: LV_TEXT_ALIGN_CENTER
                      text: !lambda |-
                        char buf[10];
                        snprintf(buf, sizeof(buf), "%.2f", id(battery_current).state);
                        return buf;
                  - label:
                      grid_cell_column_pos: 5
                      text_font: roboto12_cyrillic
                      text_color: 0xFFFFFF
                      text_align: LV_TEXT_ALIGN_CENTER
                      text: !lambda |-
                        char buf[10];
                        snprintf(buf, sizeof(buf), "%.0f", id(battery_cycles).state);
                        return buf;
                  - label:
                      grid_cell_column_pos: 6
                      text_font: roboto12_cyrillic
                      text_color: 0xFFFFFF
                      text_align: LV_TEXT_ALIGN_CENTER
                      text: !lambda |-
                        char buf[20];
                        snprintf(buf, sizeof(buf), "%.1f °C", id(battery_temp).state);
                        return buf;
      
            # ================= SECOND ROW =================
            - obj:
                grid_cell_row_pos: 3
                grid_cell_column_pos: 0
                grid_cell_column_span: 7
                height: 35
                bg_color: 0x0F1F2F   # світліший (чергування)
                widgets:
                  - label:
                      grid_cell_column_pos: 0
                      text_font: roboto12_cyrillic
                      text_color: 0xFFFFFF
                      text_align: LV_TEXT_ALIGN_CENTER
                      text: "2"
                  - label:
                      grid_cell_column_pos: 1
                      text_font: roboto12_cyrillic
                      text_color: 0x00FF00
                      text_align: LV_TEXT_ALIGN_CENTER
                      text: !lambda |-
                        char buf[10];
                        snprintf(buf, sizeof(buf), "%.0f%%", id(battery_soc_2).state);
                        return buf;
                  - label:
                      grid_cell_column_pos: 2
                      text_font: roboto12_cyrillic
                      text_color: 0xFFFFFF
                      text_align: LV_TEXT_ALIGN_CENTER
                      text: !lambda 'return id(battery_status_2)->state.c_str();'
                  - label:
                      grid_cell_column_pos: 3
                      text_font: roboto12_cyrillic
                      text_color: 0xFFFFFF
                      text_align: LV_TEXT_ALIGN_CENTER
                      text: !lambda |-
                        char buf[10];
                        snprintf(buf, sizeof(buf), "%.2f", id(battery_voltage_2).state);
                        return buf;
                  - label:
                      grid_cell_column_pos: 4
                      text_font: roboto12_cyrillic
                      text_color: 0xFFFFFF
                      text_align: LV_TEXT_ALIGN_CENTER
                      text: !lambda |-
                        char buf[10];
                        snprintf(buf, sizeof(buf), "%.2f", id(battery_current_2).state);
                        return buf;
                  - label:
                      grid_cell_column_pos: 5
                      text_font: roboto12_cyrillic
                      text_color: 0xFFFFFF
                      text_align: LV_TEXT_ALIGN_CENTER
                      text: !lambda |-
                        char buf[10];
                        snprintf(buf, sizeof(buf), "%.0f", id(battery_cycles_2).state);
                        return buf;
                  - label:
                      grid_cell_column_pos: 6
                      text_font: roboto12_cyrillic
                      text_color: 0xFFFFFF
                      text_align: LV_TEXT_ALIGN_CENTER
                      text: !lambda |-
                        char buf[20];
                        snprintf(buf, sizeof(buf), "%.1f °C", id(battery_temp_2).state);
                        return buf;

                    
        # ==================== ІСНУЮЧІ КНОПКИ ====================
        - button:
            height: $button_height_single
            width: $button_width
            checkable: false
            id: office_scene_features_button
            styles: control
            widgets:
              - label:
                  text_font: $icon_font
                  align: LV_ALIGN_TOP_LEFT
                  id: scene_features_icon
                  text: $ledstrip
              - label:
                  align: LV_ALIGN_BOTTOM_LEFT
                  id: scene_features_label
                  text: "Features"
            on_press:
              - homeassistant.service:
                  service: scene.turn_on
                  data:
                    entity_id: scene.office_features

        - button:
            height: $button_height_single
            width: $button_width
            checkable: true
            id: office_aircon_button
            styles: control
            widgets:
              - label:
                  text_font: $icon_font
                  align: LV_ALIGN_TOP_LEFT
                  text: $aircon
              - label:
                  align: LV_ALIGN_BOTTOM_LEFT
                  text: "Aircon"
            on_click:
              - homeassistant.service:
                  service: script.office_air_conditioner

        - button:
            height: $button_height_single
            width: $button_width
            checkable: false
            id: storage_lights_button
            styles: control
            widgets:
              - label:
                  text_font: $icon_font
                  align: LV_ALIGN_TOP_LEFT
                  id: storage_lights_icon
                  text: $package
              - label:
                  align: LV_ALIGN_BOTTOM_LEFT
                  id: storage_lights_label
                  text: "Storage"
            on_click:
              - homeassistant.service:
                  service: light.toggle
                  data:
                    entity_id: light.corridor_light

        - button:
            height: $button_height_single
            width: $button_width
            checkable: true
            id: network_rack_button
            styles: control
            widgets:
              - label:
                  text_font: $icon_font
                  align: LV_ALIGN_TOP_LEFT
                  id: network_rack_icon
                  text: $network
              - label:
                  align: LV_ALIGN_BOTTOM_LEFT
                  id: network_rack_label
                  text: "Network Rack"
            on_click:
              - homeassistant.service:
                  service: light.toggle
                  data:
                    entity_id: light.corridor_light
