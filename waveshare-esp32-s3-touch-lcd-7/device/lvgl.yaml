lvgl:
  style_definitions:
    - id: roboto15_cyrillic_style
      text_font: roboto15_cyrillic

  top_layer:
    widgets:
      - label:
          text: "-° / -°"
          id: temperatures
          styles: roboto15_cyrillic_style
          align: LV_ALIGN_TOP_LEFT
          x: 8
          y: 4
          text_color: 0xFFFFFF
      - label:
          text: "--:--"
          id: display_time
          styles: roboto15_cyrillic_style
          align: LV_ALIGN_TOP_MID
          x: 0
          y: 4
          text_align: LV_TEXT_ALIGN_CENTER
          text_color: 0xFFFFFF
          
  pages:
    - id: main_page
      layout:
        type: flex
        flex_flow: LV_FLEX_FLOW_COLUMN_WRAP
      width: lv_pct(100)
      bg_color: black
      bg_opa: LV_OPA_COVER
      pad_top: 30
      pad_bottom: 5
      pad_left: 5
      pad_right: 5

      widgets:
        # ==================== PYLONTECH BATTERY SECTION ====================
        - arc:
            id: battery_arc
            align: LV_ALIGN_TOP_MID
            width: 300
            height: 300
            rotation: 135
            min_value: 0
            max_value: 100
            value: !lambda 'return round(id(battery_soc).state);'
            bg_color: 0x222222
            bg_opa: LV_OPA_COVER
            line_width: 35
            line_color: 0x444444
            indicator:
              arc_color: 0x00FF00

        - label:
            id: battery_soc_label
            align: LV_ALIGN_TOP_MID
            y: -50
            text_font: montserrat_48
            text_color: 0xFFFFFF
            text: !lambda |-
              char buf[10];
              snprintf(buf, sizeof(buf), "%.1f%%", id(battery_soc));
              return buf;

        - label:
            id: battery_voltage_label
            align: LV_ALIGN_TOP_MID
            y: 110
            text_font: roboto15_cyrillic
            text_color: 0xFFFFFF
            text: !lambda |-
              char buf[20];
              snprintf(buf, sizeof(buf), "Напруга: %.2f В", id(battery_voltage));
              return buf;

        - label:
            id: battery_current_label
            align: LV_ALIGN_TOP_MID
            y: 140
            text_font: roboto15_cyrillic
            text_color: 0xFFFFFF
            text: !lambda |-
              char buf[20];
              snprintf(buf, sizeof(buf), "Струм: %.2f А", id(battery_current));
              return buf;

        # ==================== ІСНУЮЧІ КНОПКИ ====================
        - button:
            height: $button_height_single
            width: $button_width
            checkable: false
            id: office_scene_features_button
            styles: control
            widgets:
              - label:
                  text_font: $icon_font
                  align: LV_ALIGN_TOP_LEFT
                  id: scene_features_icon
                  text: $ledstrip
              - label:
                  align: LV_ALIGN_BOTTOM_LEFT
                  id: scene_features_label
                  text: "Features"
            on_press:
              - homeassistant.service:
                  service: scene.turn_on
                  data:
                    entity_id: scene.office_features

        - button:
            height: $button_height_single
            width: $button_width
            checkable: false
            id: office_scene_calls_button
            styles: control
            widgets:
              - label:
                  text_font: $icon_font
                  align: LV_ALIGN_TOP_LEFT
                  id: office_scene_calls_icon
                  text: $videocall
              - label:
                  align: LV_ALIGN_BOTTOM_LEFT
                  id: office_scene_calls_label
                  text: "Calls"
            on_press:
              - homeassistant.service:
                  service: scene.turn_on
                  data:
                    entity_id: scene.office_desk_call

        - button:
            height: $button_height_single
            width: $button_width
            checkable: false
            id: office_scene_evening_button
            styles: control
            widgets:
              - label:
                  text_font: $icon_font
                  align: LV_ALIGN_TOP_LEFT
                  id: office_scene_evening_icon
                  text: $nightlight
              - label:
                  align: LV_ALIGN_BOTTOM_LEFT
                  id: office_scene_evening_label
                  text: "Evening"
            on_press:
              - homeassistant.service:
                  service: scene.turn_on
                  data:
                    entity_id: scene.office_evening

        - button:
            height: $button_height_single
            width: $button_width
            checkable: false
            id: office_scene_dimmed_button
            styles: control
            widgets:
              - label:
                  text_font: $icon_font
                  align: LV_ALIGN_TOP_LEFT
                  id: office_scene_dimmed_icon
                  text: $nightlight
              - label:
                  align: LV_ALIGN_BOTTOM_LEFT
                  id: office_scene_dimmed_label
                  text: "Dimmed"
            on_press:
              - homeassistant.service:
                  service: scene.turn_on
                  data:
                    entity_id: scene.office_dimmed

        - button:
            height: $button_height_single
            width: $button_width
            checkable: true
            id: office_blind_open_button
            styles: control
            widgets:
              - label:
                  text_font: $icon_font
                  align: LV_ALIGN_TOP_LEFT
                  text: $blinds_open
              - label:
                  align: LV_ALIGN_BOTTOM_LEFT
                  text: "Open"
            on_click:
              - homeassistant.service:
                  service: cover.set_cover_position
                  data:
                    entity_id: cover.office_blind
                    position: "100"

        - button:
            height: $button_height_single
            width: $button_width
            checkable: true
            id: office_blind_66_button
            styles: control
            widgets:
              - label:
                  text_font: $icon_font
                  align: LV_ALIGN_TOP_LEFT
                  text: $blinds_open
              - label:
                  align: LV_ALIGN_BOTTOM_LEFT
                  text: "Semi Open"
            on_click:
              - homeassistant.service:
                  service: cover.set_cover_position
                  data:
                    entity_id: cover.office_blind
                    position: "66"

        - button:
            height: $button_height_single
            width: $button_width
            checkable: true
            id: office_blind_33_button
            styles: control
            widgets:
              - label:
                  text_font: $icon_font
                  align: LV_ALIGN_TOP_LEFT
                  text: $blinds_open
              - label:
                  align: LV_ALIGN_BOTTOM_LEFT
                  text: "Semi Closed"
            on_click:
              - homeassistant.service:
                  service: cover.set_cover_position
                  data:
                    entity_id: cover.office_blind
                    position: "33"

        - button:
            height: $button_height_single
            width: $button_width
            checkable: true
            id: office_blind_close_button
            styles: control
            widgets:
              - label:
                  text_font: $icon_font
                  align: LV_ALIGN_TOP_LEFT
                  text: $blinds_closed
              - label:
                  align: LV_ALIGN_BOTTOM_LEFT
                  text: "Close"
            on_click:
              - homeassistant.service:
                  service: cover.set_cover_position
                  data:
                    entity_id: cover.office_blind
                    position: "0"

        - button:
            height: $button_height_single
            width: $button_width
            checkable: true
            id: printer_power_button
            styles: control
            widgets:
              - label:
                  text_font: $icon_font
                  align: LV_ALIGN_TOP_LEFT
                  id: printer_power_icon
                  text: $printer
              - label:
                  align: LV_ALIGN_BOTTOM_LEFT
                  id: printer_power_label
                  text: "Printer"
            on_click:
              - homeassistant.service:
                  service: switch.toggle
                  data:
                    entity_id: switch.office_3d_printer_power

        - button:
            height: $button_height_single
            width: $button_width
            checkable: true
            id: filament_heater_button
            styles: control
            widgets:
              - label:
                  text_font: $icon_font
                  align: LV_ALIGN_TOP_LEFT
                  id: filament_heater_icon
                  text: $filament
              - label:
                  align: LV_ALIGN_BOTTOM_LEFT
                  id: filament_heater_label
                  text: "Dryer"
            on_click:
              - homeassistant.service:
                  service: switch.toggle
                  data:
                    entity_id: switch.office_filament_heater_893b

        - button:
            height: $button_height_single
            width: $button_width
            checkable: true
            id: office_aircon_button
            styles: control
            widgets:
              - label:
                  text_font: $icon_font
                  align: LV_ALIGN_TOP_LEFT
                  text: $aircon
              - label:
                  align: LV_ALIGN_BOTTOM_LEFT
                  text: "Aircon"
            on_click:
              - homeassistant.service:
                  service: script.office_air_conditioner

        - button:
            height: $button_height_single
            width: $button_width
            checkable: true
            id: battery_charger_button
            styles: control
            widgets:
              - label:
                  text_font: $icon_font
                  align: LV_ALIGN_TOP_LEFT
                  id: battery_charger_icon
                  text: $battery
              - label:
                  align: LV_ALIGN_BOTTOM_LEFT
                  id: battery_charger_label
                  text: "Charger"
            on_click:
              - homeassistant.service:
                  service: switch.toggle
                  data:
                    entity_id: switch.d4c5

        - button:
            height: $button_height_single
            width: $button_width
            checkable: true
            id: storage_lights_button
            styles: control
            widgets:
              - label:
                  text_font: $icon_font
                  align: LV_ALIGN_TOP_LEFT
                  id: storage_lights_icon
                  text: $package
              - label:
                  align: LV_ALIGN_BOTTOM_LEFT
                  id: storage_lights_label
                  text: "Storage"
            on_click:
              - homeassistant.service:
                  service: light.toggle
                  data:
                    entity_id: light.corridor_light

        - button:
            height: $button_height_single
            width: $button_width
            checkable: true
            id: network_rack_button
            styles: control
            widgets:
              - label:
                  text_font: $icon_font
                  align: LV_ALIGN_TOP_LEFT
                  id: network_rack_icon
                  text: $network
              - label:
                  align: LV_ALIGN_BOTTOM_LEFT
                  id: network_rack_label
                  text: "Network Rack"
            on_click:
              - homeassistant.service:
                  service: light.toggle
                  data:
                    entity_id: light.office_network_rack

        # ==================== ТАБЛИЦЯ БАТАРЕЙ ====================
        - obj:  # Контейнер для таблиці
            id: battery_table_container
            align: LV_ALIGN_TOP_MID
            y: 200  # Під дугою, підкорегуй за потребою
            width: lv_pct(95)
            height: 300  # Висота таблиці
            bg_color: 0x111111
            bg_opa: LV_OPA_70
            border_width: 2
            border_color: 0x00FF00
            radius: 10
            pad_all: 5
            layout:
              type: grid
              grid_columns: [50, 60, 70, 60, 60, 80, 100]  # Ширина колонок під текст
              grid_rows: [30, 30, 30, 30, 30, 30, 30, 30]  # 1 заголовок + 7 рядків (можна менше)
            widgets:
              # Заголовок
              - label:
                  grid_cell:
                    column_pos: 0
                    row_pos: 0
                  text_font: roboto15_cyrillic
                  text_color: 0x00FF00
                  text: "№"
                  text_align: LV_TEXT_ALIGN_CENTER
              - label:
                  grid_cell: { column_pos: 1, row_pos: 0 }
                  text_font: roboto15_cyrillic
                  text_color: 0x00FF00
                  text: "SOC"
              - label:
                  grid_cell: { column_pos: 2, row_pos: 0 }
                  text_font: roboto15_cyrillic
                  text_color: 0x00FF00
                  text: "State"
              - label:
                  grid_cell: { column_pos: 3, row_pos: 0 }
                  text_font: roboto15_cyrillic
                  text_color: 0x00FF00
                  text: "V"
              - label:
                  grid_cell: { column_pos: 4, row_pos: 0 }
                  text_font: roboto15_cyrillic
                  text_color: 0x00FF00
                  text: "A"
              - label:
                  grid_cell: { column_pos: 5, row_pos: 0 }
                  text_font: roboto15_cyrillic
                  text_color: 0x00FF00
                  text: "Cycles"
              - label:
                  grid_cell: { column_pos: 6, row_pos: 0 }
                  text_font: roboto15_cyrillic
                  text_color: 0x00FF00
                  text: "Temp-Mos"

              # Приклад рядка для стеку (загальні дані). Для per-battery — дублюй і змінюй ламбди
              - label:
                  grid_cell: { column_pos: 0, row_pos: 1 }
                  text_font: roboto15_cyrillic
                  text_color: 0xFFFFFF
                  text: "Стек"
              - label:
                  grid_cell: { column_pos: 1, row_pos: 1 }
                  text: !lambda |-
                    char buf[10];
                    snprintf(buf, sizeof(buf), "%.0f%%", id(battery_soc).state);
                    return buf;
              - label:
                  grid_cell: { column_pos: 2, row_pos: 1 }
                  text: !lambda 'return id(battery_state)->state.c_str();'
              - label:
                  grid_cell: { column_pos: 3, row_pos: 1 }
                  text: !lambda |-
                    char buf[10];
                    snprintf(buf, sizeof(buf), "%.2f", id(battery_voltage).state);
                    return buf;
              - label:
                  grid_cell: { column_pos: 4, row_pos: 1 }
                  text: !lambda |-
                    char buf[10];
                    snprintf(buf, sizeof(buf), "%.2f", id(battery_current).state);
                    return buf;
              - label:
                  grid_cell: { column_pos: 5, row_pos: 1 }
                  text: !lambda |-
                    char buf[10];
                    snprintf(buf, sizeof(buf), "%.0f", id(battery_cycles).state);
                    return buf;
              - label:
                  grid_cell: { column_pos: 6, row_pos: 1 }
                  text: !lambda |-
                    char buf[20];
                    snprintf(buf, sizeof(buf), "%.1f-%.1f", 14.0, 12.4);  # Заміни на реальні min-max, якщо є сенсори
                    return buf;                    
